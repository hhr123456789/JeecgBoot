# 负荷查询修改测试指南

## 修改完成情况
✅ 已完成以下修改：
1. 统一查询策略：所有查询（日/月/年）都使用原始数据查询
2. 备份原有方法：`processLoadTableFromSingleQuery` → `processLoadTableFromSingleQuery_BACKUP`
3. 更新方法注释和日志信息
4. 创建详细的备份文档

## 测试步骤

### 1. 启动应用
```bash
cd jeecg-boot
mvn spring-boot:run
```

### 2. 测试网页查询
访问负荷数据页面，分别测试：

**日查询测试**：
- 时间类型：day
- 查询日期：2025-07-12
- 预期：显示该日的最大/最小功率及精确发生时间

**月查询测试**：
- 时间类型：month  
- 查询日期：2025-07
- 预期：显示该月的最大/最小功率及精确发生时间

**年查询测试**：
- 时间类型：year
- 查询日期：2025
- 预期：显示该年的最大/最小功率及精确发生时间

### 3. 测试Excel导出
使用相同的查询参数导出Excel，对比数据：
- 最大功率值应该一致
- 最小功率值应该一致
- 最大功率发生时间应该一致（精确到秒）
- 最小功率发生时间应该一致（精确到秒）

### 4. 验证要点
- [ ] 网页显示的时间格式：`2025-07-12 18:50:21`（不再是`2025-07`）
- [ ] 功率数值与Excel导出完全一致
- [ ] 跨月查询正常工作（如查询2025-06到2025-08）
- [ ] 日志显示使用"统一原始数据查询策略"

## 预期改进效果

### 修改前（问题）：
- 网页显示：最大功率 `45.1` @ `2025-07`
- Excel导出：最大功率 `7.5` @ `2025-07-12 18:50:21`
- 问题：数据不一致，时间不准确

### 修改后（预期）：
- 网页显示：最大功率 `7.5` @ `2025-07-12 18:50:21`
- Excel导出：最大功率 `7.5` @ `2025-07-12 18:50:21`
- 效果：数据完全一致，时间精确

## 如果出现问题

### 回滚步骤：
1. 恢复查询策略选择逻辑
2. 重命名备份方法
3. 参考备份文档进行完整回滚

### 常见问题排查：
1. **查询速度变慢**：原始数据查询比聚合查询慢，属正常现象
2. **跨月查询失败**：检查数据库连接和月份数据库是否存在
3. **时间格式错误**：检查时区转换逻辑

## 联系信息
如有问题，请联系开发人员进行支持。
