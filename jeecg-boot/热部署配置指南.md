# Spring Boot 热部署配置指南

## 🚀 已完成的配置

### 1. Maven依赖配置
已在 `pom.xml` 中启用了 `spring-boot-devtools` 依赖：

```xml
<!-- Spring Boot DevTools 热部署 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <scope>runtime</scope>
    <optional>true</optional>
</dependency>
```

### 2. 应用配置
已在 `application-dev.yml` 中添加了热部署配置：

```yaml
spring:
  # 热部署配置
  devtools:
    restart:
      enabled: true
      # 设置重启的目录，添加那个目录的文件需要restart
      additional-paths: src/main/java
      # 排除那个目录的文件不需要restart
      exclude: WEB-INF/**
    livereload:
      enabled: true
      port: 35729
```

## 🔧 IDE配置（重要！）

### IntelliJ IDEA 配置

#### 步骤1：启用自动编译
1. 打开 `File` → `Settings` (或 `Ctrl+Alt+S`)
2. 导航到 `Build, Execution, Deployment` → `Compiler`
3. 勾选 `Build project automatically`
4. 点击 `Apply` 和 `OK`

#### 步骤2：启用运行时自动编译
1. 按 `Ctrl+Shift+Alt+/` 打开 Registry
2. 找到 `compiler.automake.allow.when.app.running`
3. 勾选该选项
4. 关闭 Registry 窗口

#### 步骤3：配置运行配置
1. 打开 `Run` → `Edit Configurations`
2. 选择您的Spring Boot启动配置
3. 在 `Environment` 部分，确保 `Active profiles` 设置为 `dev`
4. 在 `VM options` 中添加：
   ```
   -Dspring.devtools.restart.enabled=true
   ```

### VSCode 配置（推荐方案）

#### 方案1：使用Maven插件 + 手动触发
1. 安装VSCode扩展：
   - `Extension Pack for Java`
   - `Spring Boot Extension Pack`

2. 启动应用：
   ```bash
   mvn spring-boot:run -Dspring.profiles.active=dev
   ```

3. 修改代码后手动编译：
   ```bash
   # 在VSCode终端中执行
   mvn compile
   ```

#### 方案2：使用文件监控自动编译
1. 安装 `nodemon`（需要Node.js）：
   ```bash
   npm install -g nodemon
   ```

2. 创建监控脚本（见下方详细配置）

#### 方案3：使用VSCode任务自动化
配置VSCode任务来监控文件变化并自动编译（见下方配置）

### Eclipse/STS 配置

#### 步骤1：启用自动构建
1. 打开 `Project` → `Build Automatically`
2. 确保该选项被勾选

#### 步骤2：配置JVM参数
在运行配置中添加JVM参数：
```
-Dspring.devtools.restart.enabled=true
```

## 🎯 使用方法

### 1. 启动应用
使用开发环境配置启动应用：
```bash
mvn spring-boot:run -Dspring.profiles.active=dev
```

或者在IDE中以 `dev` profile 运行主类。

### 2. 热部署触发
当您修改以下内容时，应用会自动重启：
- Java源代码 (`.java` 文件)
- 配置文件 (`.yml`, `.properties` 文件)
- 静态资源文件

### 3. 验证热部署
1. 启动应用后，在控制台看到类似信息：
   ```
   LiveReload server is running on port 35729
   ```

2. 修改一个Controller或Service类
3. 保存文件（IDE会自动编译）
4. 观察控制台，应该看到：
   ```
   Restarting due to 1 class path change
   ```

## 📝 注意事项

### 1. 热部署范围
- ✅ **会重启**：Java代码修改、配置文件修改
- ❌ **不会重启**：依赖变更、JVM参数修改

### 2. 性能考虑
- 热部署会消耗一些内存和CPU资源
- 大型项目重启可能需要几秒钟
- 生产环境请禁用热部署

### 3. 依赖更新
如果添加了新的Maven依赖，需要：
1. 停止应用
2. 运行 `mvn clean compile`
3. 重新启动应用

### 4. 数据库连接
热部署不会影响数据库连接，连接池会保持。

## 🐛 故障排除

### 问题1：热部署不生效
**解决方案**：
1. 检查IDE是否启用了自动编译
2. 确认 `spring.profiles.active=dev`
3. 检查控制台是否有错误信息

### 问题2：重启太频繁
**解决方案**：
在 `application-dev.yml` 中调整触发条件：
```yaml
spring:
  devtools:
    restart:
      trigger-file: .reloadtrigger
```
然后手动创建/修改 `.reloadtrigger` 文件来触发重启。

### 问题3：某些文件修改不触发重启
**解决方案**：
检查文件是否在排除列表中，可以调整 `exclude` 配置。

## 🚀 快速测试

1. 启动应用
2. 修改一个Controller方法，比如添加一行日志：
   ```java
   @GetMapping("/test")
   public String test() {
       log.info("热部署测试 - 修改时间: {}", new Date());
       return "热部署测试成功！";
   }
   ```
3. 保存文件
4. 观察控制台重启信息
5. 访问接口验证修改生效

## 📊 性能对比

| 操作 | 传统重启 | 热部署 |
|------|----------|--------|
| 代码修改 | 30-60秒 | 3-10秒 |
| 配置修改 | 30-60秒 | 3-10秒 |
| 依赖修改 | 30-60秒 | 需要完整重启 |

热部署可以显著提高开发效率！
