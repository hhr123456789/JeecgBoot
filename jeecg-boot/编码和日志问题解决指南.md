# 编码和日志问题解决指南

## 🚨 问题描述
1. **中文乱码**：终端输出的中文显示为乱码
2. **日志文件不更新**：logs文件夹中的日志文件不会更新

## ✅ 已修复的问题

### 1. 中文乱码修复

#### 修改内容：
- **logback-spring.xml**：添加UTF-8编码配置
- **package.json**：添加编码参数到启动脚本
- **watch-and-compile.js**：设置编译时的编码
- **.vscode/tasks.json**：配置VSCode任务编码

#### 具体修改：
```xml
<!-- logback-spring.xml 控制台输出编码 -->
<encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
    <charset>UTF-8</charset>
    <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight(%-5level) %cyan(%logger{50}:%L) - %msg%n</pattern>
</encoder>
```

### 2. 日志文件路径修复

#### 修改内容：
```xml
<!-- 原来的相对路径 -->
<property name="LOG_HOME" value="../logs" />

<!-- 修改为绝对路径 -->
<property name="LOG_HOME" value="${user.dir}/logs" />
```

#### 说明：
- `${user.dir}` 指向当前工作目录
- 确保日志文件写入到项目根目录的 `logs` 文件夹

## 🚀 使用方法

### 方法1：使用批处理文件（Windows推荐）
```bash
# 双击运行或在命令行执行
start-dev.bat
```

### 方法2：使用Shell脚本（Linux/Mac）
```bash
# 给脚本执行权限
chmod +x start-dev.sh

# 运行脚本
./start-dev.sh
```

### 方法3：使用npm脚本
```bash
# Windows专用（包含编码设置）
npm run dev-win

# 通用版本
npm run dev
```

### 方法4：手动设置环境变量
```bash
# Windows
set JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF-8 -Dconsole.encoding=UTF-8
set MAVEN_OPTS=-Dfile.encoding=UTF-8
npm run dev

# Linux/Mac
export JAVA_TOOL_OPTIONS="-Dfile.encoding=UTF-8"
export MAVEN_OPTS="-Dfile.encoding=UTF-8"
npm run dev
```

## 📁 日志文件位置

### 修复后的日志文件位置：
```
jeecg-boot/
├── logs/
│   ├── jeecgboot-2025-08-09.0.log     # 主日志文件
│   ├── jeecgboot-2025-08-09.0.html    # HTML格式日志
│   └── error-log.html                  # 错误日志
```

### 日志文件说明：
- **主日志文件**：包含所有INFO级别以上的日志
- **HTML日志**：格式化的日志，便于浏览器查看
- **错误日志**：只包含ERROR级别的日志

## 🔍 验证修复效果

### 1. 验证中文编码
启动应用后，在控制台应该能正确显示中文：
```
🔥 热部署测试 - 当前时间: Fri Aug 09 15:30:00 CST 2025
📊 查询详情 - timeType: day, startTime: 2025-07-12 00:00:00
```

### 2. 验证日志文件
1. 启动应用
2. 访问任意接口触发日志
3. 检查 `logs` 文件夹是否有新的日志文件
4. 打开日志文件确认内容正确

### 3. 测试热部署
1. 修改代码中的中文注释或日志
2. 保存文件
3. 观察控制台输出是否正确显示中文
4. 检查日志文件是否更新

## 🐛 故障排除

### 问题1：仍然有中文乱码
**解决方案**：
1. 确认使用了正确的启动方式（推荐使用 `start-dev.bat`）
2. 检查VSCode终端编码设置：
   - 打开VSCode设置
   - 搜索 `terminal.integrated.defaultProfile.windows`
   - 确保使用 `Command Prompt` 或 `PowerShell`
3. 重启VSCode和终端

### 问题2：日志文件仍然不更新
**解决方案**：
1. 检查 `logs` 文件夹权限
2. 确认应用启动时没有权限错误
3. 手动创建 `logs` 文件夹：
   ```bash
   mkdir logs
   ```
4. 检查磁盘空间是否充足

### 问题3：VSCode终端编码问题
**解决方案**：
在VSCode的 `settings.json` 中添加：
```json
{
    "terminal.integrated.defaultProfile.windows": "Command Prompt",
    "terminal.integrated.profiles.windows": {
        "Command Prompt": {
            "path": "C:\\Windows\\System32\\cmd.exe",
            "args": ["/k", "chcp 65001"]
        }
    }
}
```

## 📊 配置文件总结

### 已修改的文件：
1. **logback-spring.xml** - 日志配置和编码
2. **package.json** - npm脚本编码参数
3. **watch-and-compile.js** - 编译脚本编码
4. **.vscode/tasks.json** - VSCode任务编码
5. **start-dev.bat** - Windows启动脚本
6. **start-dev.sh** - Linux/Mac启动脚本

### 新增的配置：
- UTF-8编码支持
- 绝对路径日志配置
- 环境变量设置
- 跨平台启动脚本

## 🎉 总结

通过以上修复，您现在应该能够：
- ✅ 在控制台正确显示中文
- ✅ 正常写入和更新日志文件
- ✅ 使用热部署功能
- ✅ 跨平台兼容（Windows/Linux/Mac）

如果还有问题，请检查具体的错误信息并参考故障排除部分。
