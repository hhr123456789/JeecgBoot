# 能源分析对比功能快速启动指南

## 🚀 快速开始

### 1. 启动应用
```bash
# 进入项目目录
cd jeecg-boot

# 启动应用
mvn spring-boot:run
# 或者
java -jar target/jeecg-boot-3.7.2.jar
```

### 2. 验证服务状态
```bash
# 健康检查
curl http://localhost:8080/jeecg-boot/energy/analysis/health
```

预期响应：
```json
{
  "success": true,
  "message": "操作成功",
  "code": 200,
  "result": "能源分析服务运行正常",
  "timestamp": 1691234567890
}
```

## 📋 核心接口测试

### 1. 获取能源类型配置
```bash
curl -X GET "http://localhost:8080/jeecg-boot/energy/analysis/getEnergyTypes" \
     -H "Accept: application/json"
```

### 2. 获取注塑部门仪表列表
```bash
curl -X GET "http://localhost:8080/jeecg-boot/energy/analysis/getModulesByDimension?orgCode=A02A02A01&energyType=1" \
     -H "Accept: application/json"
```

### 3. 查询1号注塑机日对比数据
```bash
curl -X POST "http://localhost:8080/jeecg-boot/energy/analysis/getCompareData" \
     -H "Content-Type: application/json" \
     -d '{
       "moduleId": "yj0001_1202",
       "timeType": "day",
       "startTime": "2025-07-26", 
       "endTime": "2025-08-02",
       "compareType": "compare"
     }'
```

## 🗂️ 数据库验证

### 1. 检查仪表数据
```sql
-- 查看仪表基础信息
SELECT module_id, module_name, energy_type, sys_org_code 
FROM tb_module 
WHERE isaction = 'Y' 
LIMIT 5;

-- 查看维度信息
SELECT id, depart_name, org_code, parent_id 
FROM sys_depart 
WHERE org_code IN ('A02A02A01', 'A02A02A04', 'A02A02A05');
```

### 2. 检查统计数据
```sql
-- 查看日统计数据
SELECT module_id, dt, energy_count 
FROM tb_ep_equ_energy_daycount 
WHERE module_id = 'yj0001_1202' 
ORDER BY dt DESC 
LIMIT 5;

-- 查看月统计数据
SELECT module_id, dt, energy_count 
FROM tb_ep_equ_energy_monthcount 
WHERE module_id = 'yj0001_1202' 
ORDER BY dt DESC 
LIMIT 5;
```

## 🔧 常见问题排查

### 1. 接口返回空数据
**可能原因**：
- 维度编码不存在
- 仪表数据为空
- 统计数据缺失

**排查步骤**：
```sql
-- 1. 检查维度是否存在
SELECT * FROM sys_depart WHERE org_code = 'A02A02A01';

-- 2. 检查仪表是否关联到维度
SELECT m.*, d.depart_name 
FROM tb_module m 
LEFT JOIN sys_depart d ON m.sys_org_code = d.id 
WHERE d.org_code = 'A02A02A01';

-- 3. 检查统计数据
SELECT COUNT(*) FROM tb_ep_equ_energy_daycount WHERE module_id = 'yj0001_1202';
```

### 2. 同比数据为空
**可能原因**：
- 去年同期数据不存在
- 时间范围计算错误

**排查步骤**：
```sql
-- 检查去年同期数据
SELECT * FROM tb_ep_equ_energy_daycount 
WHERE module_id = 'yj0001_1202' 
AND DATE(dt) BETWEEN '2024-07-26' AND '2024-08-02';
```

### 3. 维度查询无结果
**检查步骤**：
```sql
-- 确认org_code格式
SELECT org_code, depart_name FROM sys_depart WHERE org_code LIKE 'A02%';

-- 确认仪表的sys_org_code字段
SELECT DISTINCT sys_org_code FROM tb_module WHERE isaction = 'Y';
```

## 📊 Swagger文档访问

启动应用后，访问Swagger文档：
```
http://localhost:8080/jeecg-boot/doc.html
```

在文档中找到 "能源分析对比" 模块，可以直接在线测试接口。

## 🎯 前端集成示例

### 1. 获取仪表列表
```javascript
// 获取注塑部门的电力仪表
const getModules = async (orgCode) => {
  const response = await fetch(
    `/jeecg-boot/energy/analysis/getModulesByDimension?orgCode=${orgCode}&energyType=1`,
    {
      method: 'GET',
      headers: {
        'Accept': 'application/json'
      }
    }
  );
  return response.json();
};
```

### 2. 查询对比数据
```javascript
// 查询日对比数据
const getCompareData = async (moduleId, startTime, endTime) => {
  const response = await fetch('/jeecg-boot/energy/analysis/getCompareData', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      moduleId: moduleId,
      timeType: 'day',
      startTime: startTime,
      endTime: endTime,
      compareType: 'compare'
    })
  });
  return response.json();
};
```

### 3. 图表数据处理
```javascript
// 处理图表数据
const processChartData = (compareData) => {
  const { chartData } = compareData.result;
  
  return {
    xAxis: {
      type: 'category',
      data: chartData.categories
    },
    yAxis: {
      type: 'value',
      name: chartData.series[0].unit
    },
    series: chartData.series.map(s => ({
      name: s.name,
      type: 'line',
      data: s.data
    }))
  };
};
```

## 📈 性能优化建议

### 1. 数据库索引
```sql
-- 为统计表添加索引
CREATE INDEX idx_daycount_module_dt ON tb_ep_equ_energy_daycount(module_id, dt);
CREATE INDEX idx_monthcount_module_dt ON tb_ep_equ_energy_monthcount(module_id, dt);
CREATE INDEX idx_yearcount_module_dt ON tb_ep_equ_energy_yearcount(module_id, dt);

-- 为仪表表添加索引
CREATE INDEX idx_module_org_energy ON tb_module(sys_org_code, energy_type);
```

### 2. 缓存配置
```java
// 在Service方法上添加缓存注解
@Cacheable(value = "energyTypes", key = "'all'")
public List<EnergyTypeVO> getEnergyTypes() {
    // ...
}
```

## 🔄 数据同步检查

确保统计数据及时更新：
```sql
-- 检查最新数据时间
SELECT MAX(dt) as latest_day FROM tb_ep_equ_energy_daycount;
SELECT MAX(dt) as latest_month FROM tb_ep_equ_energy_monthcount;
SELECT MAX(dt) as latest_year FROM tb_ep_equ_energy_yearcount;
```

## 📞 技术支持

如遇问题，请提供：
1. 错误日志
2. 请求参数
3. 数据库查询结果
4. 应用版本信息

---

**祝您使用愉快！** 🎉
