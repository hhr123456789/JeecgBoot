# å®žæ—¶æ•°æ®ç›‘æŽ§æŽ¥å£å®žçŽ°æ€»ç»“

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

æ ¹æ®Real_Data_Monitor.mdæ–‡æ¡£çš„éœ€æ±‚ï¼ŒæˆåŠŸå®žçŽ°äº†èƒ½æºç®¡ç†ç³»ç»Ÿä¸­å®žæ—¶æ•°æ®ç›‘æŽ§æ¨¡å—çš„å®Œæ•´åŽç«¯æŽ¥å£ï¼Œæ”¯æŒæŒ‰ç»´åº¦æ ‘é€‰æ‹©ä»ªè¡¨ï¼ŒæŸ¥çœ‹å¤šå‚æ•°çš„æ—¶åºæ•°æ®å›¾è¡¨ã€‚

## ðŸŽ¯ å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒæŽ¥å£å®žçŽ°
- âœ… **æ ¹æ®ç»´åº¦èŽ·å–ä»ªè¡¨åˆ—è¡¨æŽ¥å£** (`/energy/monitor/getModulesByOrgCode`)
- âœ… **å®žæ—¶æ•°æ®æŸ¥è¯¢æŽ¥å£** (`/energy/monitor/getRealTimeMonitorData`)
- âœ… æ”¯æŒç»Ÿä¸€æ˜¾ç¤ºå’Œåˆ†å¼€æ˜¾ç¤ºä¸¤ç§æ¨¡å¼
- âœ… æ”¯æŒå¤šä»ªè¡¨å¤šå‚æ•°æŸ¥è¯¢
- âœ… æ”¯æŒæ—¶é—´é—´éš”èšåˆ (15åˆ†é’Ÿã€30åˆ†é’Ÿã€1å°æ—¶ã€2å°æ—¶)

### 2. æ•°æ®å¤„ç†èƒ½åŠ›
- âœ… **InfluxDBæ—¶åºæ•°æ®æŸ¥è¯¢**: ä»ŽInfluxDBèŽ·å–å®žæ—¶æ•°æ®
- âœ… **MySQLå…³è”æŸ¥è¯¢**: èŽ·å–ä»ªè¡¨åç§°å’Œç»´åº¦ä¿¡æ¯
- âœ… **æ—¶åŒºè‡ªåŠ¨è½¬æ¢**: UTCæ—¶é—´ä¸Žæœ¬åœ°æ—¶é—´çš„è‡ªåŠ¨è½¬æ¢
- âœ… **æ•°æ®èšåˆ**: æŒ‰æ—¶é—´é—´éš”èšåˆæ•°æ®ï¼Œä½¿ç”¨å¹³å‡å€¼è®¡ç®—
- âœ… **å‚æ•°æ˜ å°„**: å‚æ•°ç¼–å·åˆ°InfluxDBå­—æ®µçš„è‡ªåŠ¨æ˜ å°„

### 3. æŠ€æœ¯æž¶æž„
- âœ… **é…ç½®ç±»**: ParameterConfigã€IntervalConfig
- âœ… **VOç±»**: å®Œæ•´çš„è¯·æ±‚å’Œå“åº”VOç±»
- âœ… **æœåŠ¡å±‚**: æ•°æ®æŸ¥è¯¢ã€æ ¼å¼åŒ–ã€éªŒè¯æœåŠ¡
- âœ… **æŽ§åˆ¶å™¨**: RESTful APIæŽ¥å£
- âœ… **å¼‚å¸¸å¤„ç†**: å®Œæ•´çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

## ðŸ“ æ–‡ä»¶ç»“æž„

```
jeecg-module-energy/
â”œâ”€â”€ src/main/java/org/jeecg/modules/energy/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ ParameterConfig.java          # å‚æ•°é…ç½®ç±»
â”‚   â”‚   â””â”€â”€ IntervalConfig.java           # æ—¶é—´é—´éš”é…ç½®ç±»
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ EnergyMonitorController.java  # æŽ§åˆ¶å™¨ (å·²æ›´æ–°)
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ IDataFormatService.java       # æ•°æ®æ ¼å¼åŒ–æœåŠ¡æŽ¥å£
â”‚   â”‚   â”œâ”€â”€ IInfluxDBQueryService.java    # InfluxDBæŸ¥è¯¢æœåŠ¡æŽ¥å£
â”‚   â”‚   â”œâ”€â”€ IEnergyMonitorService.java    # èƒ½æºç›‘æŽ§æœåŠ¡æŽ¥å£ (å·²æ›´æ–°)
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚       â”œâ”€â”€ DataFormatServiceImpl.java        # æ•°æ®æ ¼å¼åŒ–æœåŠ¡å®žçŽ°
â”‚   â”‚       â”œâ”€â”€ InfluxDBQueryServiceImpl.java     # InfluxDBæŸ¥è¯¢æœåŠ¡å®žçŽ°
â”‚   â”‚       â””â”€â”€ EnergyMonitorServiceImpl.java     # èƒ½æºç›‘æŽ§æœåŠ¡å®žçŽ° (å·²æ›´æ–°)
â”‚   â””â”€â”€ vo/monitor/
â”‚       â”œâ”€â”€ ModuleVO.java                 # ä»ªè¡¨ä¿¡æ¯VO
â”‚       â”œâ”€â”€ RealTimeDataRequest.java      # å®žæ—¶æ•°æ®è¯·æ±‚VO
â”‚       â”œâ”€â”€ TimeRangeVO.java              # æ—¶é—´èŒƒå›´VO
â”‚       â”œâ”€â”€ SeriesDataVO.java             # ç³»åˆ—æ•°æ®VO
â”‚       â”œâ”€â”€ ChartDataVO.java              # å›¾è¡¨æ•°æ®VO
â”‚       â”œâ”€â”€ UnifiedDisplayResult.java     # ç»Ÿä¸€æ˜¾ç¤ºç»“æžœVO
â”‚       â””â”€â”€ SeparatedDisplayResult.java   # åˆ†å¼€æ˜¾ç¤ºç»“æžœVO
â”œâ”€â”€ src/test/java/org/jeecg/modules/energy/
â”‚   â””â”€â”€ controller/
â”‚       â””â”€â”€ EnergyMonitorControllerTest.java  # æŽ§åˆ¶å™¨æµ‹è¯• (å·²æ›´æ–°)
â”œâ”€â”€ README_RealTimeMonitor.md             # ä½¿ç”¨è¯´æ˜Žæ–‡æ¡£
â”œâ”€â”€ API_Documentation.md                  # APIæ–‡æ¡£
â””â”€â”€ IMPLEMENTATION_SUMMARY.md             # å®žçŽ°æ€»ç»“ (æœ¬æ–‡ä»¶)
```

## ðŸ”§ æŠ€æœ¯å®žçŽ°è¦ç‚¹

### 1. å‚æ•°æ˜ å°„ç³»ç»Ÿ
```java
// å‚æ•°ç¼–å·åˆ°InfluxDBå­—æ®µçš„æ˜ å°„
PARAMETER_MAP.put(1, new ParameterInfo("IA", "Aç›¸ç”µæµ", "A"));
PARAMETER_MAP.put(4, new ParameterInfo("UA", "Aç›¸ç”µåŽ‹", "V"));
PARAMETER_MAP.put(7, new ParameterInfo("PP", "æ€»æœ‰åŠŸåŠŸçŽ‡", "kW"));
```

### 2. æ—¶é—´é—´éš”é…ç½®
```java
// æŸ¥è¯¢é—´éš”æ˜ å°„
INTERVAL_MAP.put(1, "15m");   // 15åˆ†é’Ÿ
INTERVAL_MAP.put(2, "30m");   // 30åˆ†é’Ÿ
INTERVAL_MAP.put(3, "1h");    // 1å°æ—¶
INTERVAL_MAP.put(4, "2h");    // 2å°æ—¶
```

### 3. InfluxDBæŸ¥è¯¢æž„å»º
```sql
SELECT mean(value) as value 
FROM hist 
WHERE time >= '2025-07-15T00:00:00Z' AND time <= '2025-07-15T08:00:00Z' 
AND tagname IN ('YJ0001_1202#IA', 'YJ0001_1202#UA') 
AND status = 1 
GROUP BY time(15m), tagname 
ORDER BY time ASC
```

### 4. æ—¶åŒºè½¬æ¢å¤„ç†
```java
// æœ¬åœ°æ—¶é—´è½¬UTCæ—¶é—´
LocalDateTime local = LocalDateTime.parse(localTime, DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
ZonedDateTime utc = local.atZone(ZoneId.of("Asia/Shanghai")).withZoneSameInstant(ZoneOffset.UTC);
```

## ðŸ“Š æŽ¥å£è§„èŒƒ

### 1. ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
    "success": true,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "code": 200,
    "result": { ... }
}
```

### 2. å‚æ•°éªŒè¯
- âœ… å¿…å¡«å‚æ•°éªŒè¯
- âœ… å‚æ•°æ ¼å¼éªŒè¯
- âœ… å‚æ•°èŒƒå›´éªŒè¯
- âœ… ä¸šåŠ¡é€»è¾‘éªŒè¯

### 3. å¼‚å¸¸å¤„ç†
- âœ… å‚æ•°å¼‚å¸¸å¤„ç†
- âœ… æ•°æ®åº“è¿žæŽ¥å¼‚å¸¸å¤„ç†
- âœ… æ•°æ®æ ¼å¼å¼‚å¸¸å¤„ç†
- âœ… ä¸šåŠ¡é€»è¾‘å¼‚å¸¸å¤„ç†

## ðŸ§ª æµ‹è¯•è¦†ç›–

### 1. å•å…ƒæµ‹è¯•
- âœ… æŽ§åˆ¶å™¨å±‚æµ‹è¯•
- âœ… æœåŠ¡å±‚æµ‹è¯• (Mock)
- âœ… å‚æ•°éªŒè¯æµ‹è¯•
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•

### 2. ç¼–è¯‘æµ‹è¯•
- âœ… Mavenç¼–è¯‘é€šè¿‡
- âœ… ä¾èµ–æ³¨å…¥æ­£å¸¸
- âœ… ä»£ç è¯­æ³•æ­£ç¡®

## ðŸ“š æ–‡æ¡£å®Œæ•´æ€§

- âœ… **Real_Data_Monitor.md**: åŽŸå§‹éœ€æ±‚æ–‡æ¡£
- âœ… **README_RealTimeMonitor.md**: ä½¿ç”¨è¯´æ˜Žæ–‡æ¡£
- âœ… **API_Documentation.md**: APIæŽ¥å£æ–‡æ¡£
- âœ… **IMPLEMENTATION_SUMMARY.md**: å®žçŽ°æ€»ç»“æ–‡æ¡£
- âœ… **Swaggeræ³¨è§£**: å®Œæ•´çš„æŽ¥å£æ–‡æ¡£æ³¨è§£

## ðŸš€ éƒ¨ç½²å’Œä½¿ç”¨

### 1. å¯åŠ¨åº”ç”¨
```bash
cd jeecg-boot
mvn spring-boot:run
```

### 2. è®¿é—®Swaggeræ–‡æ¡£
```
http://localhost:8080/jeecg-boot/doc.html
```

### 3. æµ‹è¯•æŽ¥å£
åœ¨Swaggerä¸­æ‰¾åˆ°"èƒ½æºå®žæ—¶ç›‘æŽ§"æ ‡ç­¾ï¼Œå¯ä»¥ç›´æŽ¥æµ‹è¯•æŽ¥å£ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“é…ç½®**: ç¡®ä¿InfluxDBå’ŒMySQLè¿žæŽ¥é…ç½®æ­£ç¡®
2. **æ—¶åŒºè®¾ç½®**: ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ä¸œå…«åŒºæ—¶é—´
3. **æ•°æ®é‡æŽ§åˆ¶**: å»ºè®®åˆç†è®¾ç½®æŸ¥è¯¢æ—¶é—´èŒƒå›´
4. **å‚æ•°æ˜ å°„**: å‚æ•°ç¼–å·éœ€è¦ä¸Žå­—å…¸è¡¨ä¿æŒä¸€è‡´
5. **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é‡æŸ¥è¯¢æ—¶è€ƒè™‘åˆ†é¡µæˆ–ç¼“å­˜

## ðŸ”„ åŽç»­æ‰©å±•

1. **ç¼“å­˜æœºåˆ¶**: å¯ä»¥æ·»åŠ Redisç¼“å­˜æé«˜æŸ¥è¯¢æ€§èƒ½
2. **æ•°æ®åŽ‹ç¼©**: å¯¹äºŽå¤§é‡æ•°æ®å¯ä»¥è€ƒè™‘åŽ‹ç¼©ä¼ è¾“
3. **å®žæ—¶æŽ¨é€**: å¯ä»¥æ·»åŠ WebSocketå®žçŽ°æ•°æ®å®žæ—¶æŽ¨é€
4. **æŠ¥è¡¨åŠŸèƒ½**: å¯ä»¥æ‰©å±•ä¸ºæŠ¥è¡¨ç”ŸæˆåŠŸèƒ½
5. **æƒé™æŽ§åˆ¶**: å¯ä»¥æ·»åŠ åŸºäºŽè§’è‰²çš„æ•°æ®è®¿é—®æŽ§åˆ¶

## âœ… éªŒæ”¶æ ‡å‡†

- [x] æŽ¥å£åŠŸèƒ½å®Œæ•´å®žçŽ°
- [x] ä»£ç ç¼–è¯‘é€šè¿‡
- [x] å•å…ƒæµ‹è¯•è¦†ç›–
- [x] æ–‡æ¡£å®Œæ•´é½å…¨
- [x] SwaggeræŽ¥å£æ–‡æ¡£
- [x] å¼‚å¸¸å¤„ç†å®Œå–„
- [x] ç¬¦åˆJeecgBootæ¡†æž¶è§„èŒƒ

**å®žçŽ°çŠ¶æ€**: âœ… å®Œæˆ

**äº¤ä»˜æ—¶é—´**: 2025-07-16

**å¼€å‘è€…**: Augment Agent
