# 实时数据监控接口测试说明

## ✅ 问题修复完成

已修复的问题：
1. ✅ 实体类字段访问方法名错误 - 已修正为正确的getter方法名
2. ✅ `@ApiParam` 注解位置错误 - 已移除不当使用的注解
3. ✅ `LocalDateTime.of()` 方法参数错误 - 已添加小时和分钟参数
4. ✅ 重复变量名问题 - 已重命名变量避免冲突
5. ✅ 类型转换问题 - 已确保类型匹配

## 🧪 测试步骤

### 1. 启动应用
```bash
cd jeecg-boot
mvn spring-boot:run
```

### 2. 访问Swagger文档
打开浏览器访问：`http://localhost:8080/jeecg-boot/doc.html`

在Swagger中找到 **"实时数据监控"** 和 **"实时数据监控测试"** 标签

### 3. 测试接口

#### 3.1 测试获取仪表列表
```
GET /energy/realtime/test/testGetModules
```
这个接口会测试根据维度"A02A02A01"（注塑部门）获取电力仪表列表

#### 3.2 测试获取参数配置
```
GET /energy/realtime/test/testGetParameters
```
这个接口会返回电力类型的所有可选参数配置

#### 3.3 测试查询时序数据
```
GET /energy/realtime/test/testGetTimeSeriesData
```
这个接口会模拟查询仪表"yj0001_13"和"yj0001_14"的A相电流、B相电流和总有功功率数据

#### 3.4 测试获取实时状态
```
GET /energy/realtime/test/testGetCurrentStatus
```
这个接口会获取指定仪表的实时状态信息

### 4. 正式接口测试

#### 4.1 获取仪表列表
```
GET /energy/realtime/getModulesByDimension?dimensionCode=A02A02A01&energyType=1&includeChildren=true
```

#### 4.2 获取参数配置
```
GET /energy/realtime/getParameterConfig?energyType=1
```

#### 4.3 查询时序数据
```
POST /energy/realtime/getTimeSeriesData
Content-Type: application/json

{
    "moduleIds": ["yj0001_13", "yj0001_14"],
    "parameters": [1, 2, 7],
    "timeGranularity": "day",
    "queryDate": "2025-07-25"
}
```

#### 4.4 获取实时状态
```
POST /energy/realtime/getCurrentStatus
Content-Type: application/json

{
    "moduleIds": ["yj0001_13", "yj0001_14"],
    "parameters": [1, 2, 7]
}
```

## 📊 预期结果

### 仪表列表响应示例
```json
{
    "success": true,
    "message": "查询成功",
    "code": 200,
    "result": [
        {
            "moduleId": "yj0001_13",
            "moduleName": "3号注塑机",
            "energyType": 1,
            "dimensionCode": "1940618949271535617",
            "dimensionName": "3号注塑机",
            "ratedPower": 1000.0,
            "isAction": "Y",
            "updateTime": "2025-07-03 16:43:45"
        }
    ]
}
```

### 参数配置响应示例
```json
{
    "success": true,
    "message": "查询成功", 
    "code": 200,
    "result": [
        {
            "paramCode": 1,
            "paramName": "A相电流",
            "fieldName": "IA",
            "unit": "A",
            "category": "电流",
            "isDefault": true,
            "energyType": 1
        }
    ]
}
```

### 时序数据响应示例
```json
{
    "success": true,
    "message": "查询成功",
    "code": 200,
    "result": {
        "chartData": {
            "timeLabels": ["00:00", "01:00", "02:00", ...],
            "series": [
                {
                    "moduleId": "yj0001_13",
                    "moduleName": "3号注塑机",
                    "paramCode": 1,
                    "paramName": "A相电流",
                    "unit": "A",
                    "data": [95.2, 96.1, 94.8, ...],
                    "color": "#1890ff"
                }
            ]
        },
        "tableData": [...],
        "summary": {
            "totalDataPoints": 72,
            "timeRange": "2025-07-25 00:00:00 ~ 2025-07-25 23:59:59",
            "granularity": "每小时",
            "moduleCount": 2,
            "parameterCount": 3
        }
    }
}
```

## 🔧 前端集成

### Vue.js示例
```javascript
// 获取仪表列表
async getModulesByDimension(dimensionCode) {
    try {
        const response = await this.$http.get('/energy/realtime/getModulesByDimension', {
            params: {
                dimensionCode: dimensionCode,
                energyType: 1,
                includeChildren: true
            }
        });
        
        if (response.data.success) {
            this.moduleList = response.data.result;
        }
    } catch (error) {
        console.error('获取仪表列表失败:', error);
    }
}

// 查询时序数据
async queryTimeSeriesData() {
    try {
        const response = await this.$http.post('/energy/realtime/getTimeSeriesData', {
            moduleIds: this.selectedModuleIds,
            parameters: this.selectedParameters,
            timeGranularity: this.timeGranularity,
            queryDate: this.queryDate
        });
        
        if (response.data.success) {
            this.updateChart(response.data.result.chartData);
            this.updateTable(response.data.result.tableData);
        }
    } catch (error) {
        console.error('查询时序数据失败:', error);
    }
}
```

## 📝 注意事项

1. **数据库连接**：确保MySQL和InfluxDB连接正常
2. **测试数据**：如果没有实际数据，接口会返回模拟数据用于测试
3. **时区处理**：所有时间都会自动转换为北京时间显示
4. **错误处理**：接口包含完整的异常处理和错误信息返回

## 🚀 下一步

1. 测试所有接口功能是否正常
2. 根据实际需求调整数据格式
3. 完善InfluxDB数据解析逻辑
4. 添加更多的参数类型支持
5. 优化性能和缓存策略
