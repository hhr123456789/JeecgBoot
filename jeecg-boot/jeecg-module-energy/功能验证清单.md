# 实时数据监控接口功能验证清单

## ✅ 编译错误修复完成

所有编译错误已修复：
- ✅ LocalDateTime.of() 方法参数错误 - 已添加完整的时间参数
- ✅ BigDecimal到Double类型转换 - 已添加.doubleValue()转换
- ✅ 未使用的字段警告 - 已移除timeZoneUtil字段
- ✅ @ApiParam注解位置错误 - 已修正

## 🧪 功能测试清单

### 1. 基础功能测试

#### ✅ 测试接口可访问性
- [ ] 启动应用：`mvn spring-boot:run`
- [ ] 访问Swagger文档：http://localhost:8080/jeecg-boot/doc.html
- [ ] 确认"实时数据监控"和"实时数据监控测试"标签存在

#### ✅ 测试接口基本功能
- [ ] 测试获取仪表列表：`GET /energy/realtime/test/testGetModules`
- [ ] 测试获取参数配置：`GET /energy/realtime/test/testGetParameters`
- [ ] 测试查询时序数据：`GET /energy/realtime/test/testGetTimeSeriesData`
- [ ] 测试获取实时状态：`GET /energy/realtime/test/testGetCurrentStatus`

### 2. 正式接口测试

#### ✅ 维度仪表查询
```http
GET /energy/realtime/getModulesByDimension?dimensionCode=A02A02A01&energyType=1&includeChildren=true
```
**预期结果**：
- 返回指定维度下的电力仪表列表
- 包含仪表ID、名称、能源类型等信息
- 如果没有数据，返回空数组

#### ✅ 参数配置查询
```http
GET /energy/realtime/getParameterConfig?energyType=1
```
**预期结果**：
- 返回电力类型的12个参数配置
- 包含参数编码、名称、单位、是否默认选中等信息

#### ✅ 时序数据查询
```http
POST /energy/realtime/getTimeSeriesData
{
    "moduleIds": ["yj0001_13", "yj0001_14"],
    "parameters": [1, 2, 7],
    "timeGranularity": "day",
    "queryDate": "2025-07-25"
}
```
**预期结果**：
- 返回图表数据（timeLabels + series）
- 返回表格数据
- 返回汇总信息
- 如果没有InfluxDB数据，返回模拟数据

#### ✅ 实时状态查询
```http
POST /energy/realtime/getCurrentStatus
{
    "moduleIds": ["yj0001_13", "yj0001_14"],
    "parameters": [1, 2, 7]
}
```
**预期结果**：
- 返回仪表在线状态
- 返回最新参数数值
- 返回最后更新时间

### 3. 边界条件测试

#### ✅ 参数验证测试
- [ ] 空的moduleIds列表 - 应返回参数错误
- [ ] 空的parameters列表 - 应返回参数错误
- [ ] 无效的timeGranularity - 应返回参数错误
- [ ] 无效的queryDate格式 - 应返回参数错误

#### ✅ 不同时间粒度测试
- [ ] day粒度：返回24小时数据点
- [ ] month粒度：返回当月每天数据点
- [ ] year粒度：返回12个月数据点

#### ✅ 不同能源类型测试
- [ ] energyType=1（电力）：返回12个电力参数
- [ ] energyType=2（天然气）：返回4个通用能源参数
- [ ] energyType=3（压缩空气）：返回4个通用能源参数
- [ ] energyType=4（企业用水）：返回4个通用能源参数

### 4. 数据库连接测试

#### ✅ MySQL连接测试
- [ ] 仪表基础信息查询正常
- [ ] 维度部门信息查询正常
- [ ] 实时数据表查询正常

#### ✅ InfluxDB连接测试
- [ ] InfluxDB连接正常（如果配置了）
- [ ] 时序数据查询正常（如果有数据）
- [ ] 无数据时模拟数据生成正常

### 5. 性能测试

#### ✅ 响应时间测试
- [ ] 仪表列表查询 < 1秒
- [ ] 参数配置查询 < 0.5秒
- [ ] 时序数据查询 < 3秒
- [ ] 实时状态查询 < 2秒

#### ✅ 并发测试
- [ ] 多个用户同时查询不冲突
- [ ] 大量数据查询不超时

### 6. 前端集成测试

#### ✅ 数据格式验证
- [ ] 图表数据格式符合ECharts要求
- [ ] 表格数据格式符合前端表格组件要求
- [ ] 时间标签格式正确
- [ ] 颜色配置正确

#### ✅ 错误处理验证
- [ ] 网络错误时返回友好错误信息
- [ ] 参数错误时返回具体错误描述
- [ ] 数据库连接失败时返回适当错误

## 🔧 故障排查指南

### 常见问题及解决方案

#### 1. 接口404错误
**原因**：应用未启动或路径错误
**解决**：
- 确认应用已启动
- 检查请求路径是否正确
- 确认Controller注解配置正确

#### 2. 仪表列表为空
**原因**：
- 维度编码不存在
- 该维度下没有对应能源类型的仪表
- 仪表isaction字段不是'Y'

**解决**：
- 检查sys_depart表中是否有对应的org_code
- 检查tb_module表中是否有对应的仪表数据
- 确认仪表的energy_type和isaction字段值

#### 3. 时序数据查询失败
**原因**：
- InfluxDB连接失败
- 查询语句错误
- 数据格式不匹配

**解决**：
- 检查InfluxDB连接配置
- 查看日志中的具体错误信息
- 验证tagname格式是否正确

#### 4. 实时状态显示离线
**原因**：
- 实时数据表中没有最新数据
- 数据更新时间超过5分钟

**解决**：
- 检查tb_equ_ele_data和tb_equ_energy_data表
- 确认数据采集程序正常运行
- 调整在线判断时间阈值

## 📊 测试报告模板

### 测试环境
- 操作系统：Windows/Linux
- Java版本：JDK 8+
- 数据库：MySQL 5.7+, InfluxDB 1.8
- 应用版本：jeecg-boot 3.x

### 测试结果
| 功能模块 | 测试用例 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|---------|------|
| 仪表列表查询 | 根据维度获取仪表 | 返回仪表列表 | | ⭕ |
| 参数配置查询 | 获取电力参数配置 | 返回12个参数 | | ⭕ |
| 时序数据查询 | 查询日粒度数据 | 返回24小时数据 | | ⭕ |
| 实时状态查询 | 获取仪表状态 | 返回在线状态 | | ⭕ |

### 问题记录
| 问题描述 | 严重程度 | 状态 | 解决方案 |
|---------|---------|------|---------|
| | | | |

### 测试结论
- [ ] 所有核心功能正常
- [ ] 性能满足要求
- [ ] 错误处理完善
- [ ] 可以投入使用

## 🚀 部署建议

1. **生产环境配置**
   - 配置正确的数据库连接
   - 设置合适的连接池大小
   - 配置日志级别和输出路径

2. **监控建议**
   - 监控接口响应时间
   - 监控数据库连接状态
   - 监控InfluxDB查询性能

3. **优化建议**
   - 对频繁查询的数据进行缓存
   - 对大量数据查询进行分页
   - 定期清理过期的时序数据
