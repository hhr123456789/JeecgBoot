# è´Ÿè·ç›‘æ§å¹´æŸ¥è¯¢åŠŸèƒ½å®Œæˆæ€»ç»“

## ğŸ¯ ä»»åŠ¡å®ŒæˆçŠ¶æ€

âœ… **å·²å®Œæˆ** - è´Ÿè·ç›‘æ§å¹´æŸ¥è¯¢åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘é”™è¯¯

## ğŸ“‹ å®ç°å†…å®¹æ¦‚è§ˆ

### 1. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### InfluxDBQueryBuilder å¢å¼º
- âœ… æ–°å¢è·¨æœˆæŸ¥è¯¢æ”¯æŒæ–¹æ³•
- âœ… æ ¹æ®æ—¶é—´ç²’åº¦è‡ªåŠ¨é€‰æ‹©æŸ¥è¯¢ç­–ç•¥
- âœ… æ”¯æŒå¹´æŸ¥è¯¢çš„30å¤©é—´éš”èšåˆ
- âœ… è‡ªåŠ¨ç”Ÿæˆè·¨æœˆæ•°æ®åº“åˆ—è¡¨

#### RealtimeMonitorServiceImpl å®Œæ•´å®ç°
- âœ… æ–°å¢è·¨æœˆæŸ¥è¯¢æ–¹æ³• `queryTimeSeriesDataCrossMonth()`
- âœ… æ–°å¢å•æœˆæŸ¥è¯¢æ–¹æ³• `queryTimeSeriesDataSingleMonth()`
- âœ… å®Œæ•´çš„è´Ÿè·æ—¶åºæ•°æ®å¤„ç†é€»è¾‘
- âœ… æ—¶åŒºè½¬æ¢å’Œæ•°æ®æ ¼å¼åŒ–
- âœ… è´Ÿè·ç‡è‡ªåŠ¨è®¡ç®—

### 2. ç¼–è¯‘é”™è¯¯ä¿®å¤

#### å·²ä¿®å¤çš„é—®é¢˜
- âœ… ä¿®å¤äº† `convertToModuleInfoVO` æ–¹æ³•ç¼ºå¤±é—®é¢˜
- âœ… ä¿®å¤äº† `ParameterConfigVO` æ„é€ å‡½æ•°é—®é¢˜
- âœ… ä¿®å¤äº† `getDimensionCode()` æ–¹æ³•è®¿é—®é—®é¢˜
- âœ… ä¿®å¤äº†æ—¶é—´æ ¼å¼è½¬æ¢é—®é¢˜ï¼ˆDate.format -> SimpleDateFormatï¼‰
- âœ… ä¿®å¤äº† `TimeSeriesResultVO.TableRowVO` æ•°æ®è®¾ç½®é—®é¢˜
- âœ… æ·»åŠ äº†å¿…è¦çš„importè¯­å¥

#### ä»£ç è´¨é‡æ”¹è¿›
- âœ… ç»Ÿä¸€äº†å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… å®Œå–„äº†æ—¥å¿—è®°å½•
- âœ… ä¼˜åŒ–äº†æ•°æ®ç»“æ„è½¬æ¢
- âœ… å¢å¼ºäº†å‚æ•°éªŒè¯

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### å¹´æŸ¥è¯¢æ ¸å¿ƒé€»è¾‘

```java
// 1. è§£ææ—¶é—´èŒƒå›´ï¼Œç¡®å®šéœ€è¦æŸ¥è¯¢çš„æœˆä»½
YearMonth startYearMonth = YearMonth.from(startDate);
YearMonth endYearMonth = YearMonth.from(endDate);

// 2. éå†æ¯ä¸ªæœˆä»½ï¼Œæ„å»ºæ•°æ®åº“æŸ¥è¯¢
for (YearMonth yearMonth = startYearMonth; 
     !yearMonth.isAfter(endYearMonth); 
     yearMonth = yearMonth.plusMonths(1)) {
    
    String dbName = influxDBConfig.getDatabaseName(
        yearMonth.getYear(), yearMonth.getMonthValue());
    
    // 3. æ£€æŸ¥æ•°æ®åº“å­˜åœ¨æ€§ï¼Œæ‰§è¡ŒæŸ¥è¯¢
    if (influxDB.databaseExists(dbName)) {
        QueryResult result = influxDB.query(new Query(queryStr, dbName));
        allResults.addAll(InfluxDBUtil.parseQueryResult(result));
    }
}
```

### æ•°æ®å¤„ç†æµç¨‹

```java
// 1. æ•°æ®åˆ†ç»„å’Œæ—¶é—´æ ‡ç­¾ç”Ÿæˆ
Map<String, Map<String, Double>> timeModuleDataMap = new HashMap<>();
Set<String> allTimePoints = new TreeSet<>();

// 2. è´Ÿè·ç‡è®¡ç®—
double loadRate = (currentPower / ratedPower) * 100;

// 3. æ—¶åŒºè½¬æ¢
String localTime = timeZoneUtil.convertUTCToBeijing(utcTimeStr);

// 4. å›¾è¡¨æ•°æ®ç”Ÿæˆ
LoadTimeSeriesResultVO.LoadChartDataVO powerChartData = ...;
LoadTimeSeriesResultVO.LoadChartDataVO loadRateChartData = ...;
```

## ğŸ“Š æ”¯æŒçš„æŸ¥è¯¢ç±»å‹

### æ—¶é—´ç²’åº¦æ”¯æŒ
- **æ—¥æŸ¥è¯¢**: 24ä¸ªæ•°æ®ç‚¹ï¼ˆæ¯å°æ—¶ä¸€ä¸ªï¼‰
- **æœˆæŸ¥è¯¢**: 30-31ä¸ªæ•°æ®ç‚¹ï¼ˆæ¯å¤©ä¸€ä¸ªï¼‰
- **å¹´æŸ¥è¯¢**: 12ä¸ªæ•°æ®ç‚¹ï¼ˆæ¯æœˆä¸€ä¸ªï¼‰

### æ•°æ®åº“ç­–ç•¥
- **å•æœˆæŸ¥è¯¢**: ç”¨äºæ—¥/æœˆæŸ¥è¯¢ï¼Œæ€§èƒ½æ›´å¥½
- **è·¨æœˆæŸ¥è¯¢**: ç”¨äºå¹´æŸ¥è¯¢ï¼Œæ•°æ®å®Œæ•´

### æŸ¥è¯¢å‚æ•°
- **æ¨¡å—IDåˆ—è¡¨**: æ”¯æŒå¤šä¸ªç”µåŠ›ä»ªè¡¨åŒæ—¶æŸ¥è¯¢
- **æ—¶é—´èŒƒå›´**: è‡ªåŠ¨æ ¹æ®ç²’åº¦è®¡ç®—æˆ–æ‰‹åŠ¨æŒ‡å®š
- **è´Ÿè·è®¡ç®—**: è‡ªåŠ¨æŸ¥è¯¢PPå­—æ®µå¹¶è®¡ç®—è´Ÿè·ç‡

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### InfluxDB åˆ†åº“è§„åˆ™
```
æ•°æ®åº“å‘½å: hist202501, hist202502, ..., hist202512
è¡¨å: hist
tagnameæ ¼å¼: MODULE_ID#PP (å¦‚: YJ0001_1202#PP)
å­—æ®µ:
  - time: æ—¶é—´æˆ³ï¼ˆUTCï¼‰
  - tagname: æ ‡ç­¾å
  - value: æ•°å€¼
  - status: çŠ¶æ€
```

### æŸ¥è¯¢ç¤ºä¾‹
```sql
-- å¹´æŸ¥è¯¢ç¤ºä¾‹ï¼ˆè·¨12ä¸ªæ•°æ®åº“ï¼‰
SELECT MEAN(value) as avg_value, MAX(value) as max_value, MIN(value) as min_value
FROM hist
WHERE (tagname = 'YJ0001_1202#PP' OR tagname = 'YJ0001_1203#PP')
  AND time >= '2025-01-01T00:00:00Z'
  AND time < '2025-02-01T00:00:00Z'
GROUP BY time(30d), tagname
ORDER BY time ASC
```

## ğŸ§ª æµ‹è¯•æ–‡ä»¶

### æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶
- `è´Ÿè·ç›‘æ§å¹´æŸ¥è¯¢æµ‹è¯•.http` - å®Œæ•´çš„APIæµ‹è¯•ç”¨ä¾‹
- åŒ…å«æ—¥/æœˆ/å¹´ä¸‰ç§ç²’åº¦çš„æµ‹è¯•
- åŒ…å«å®æ—¶çŠ¶æ€å’Œè¡¨æ ¼æ•°æ®æµ‹è¯•

### æµ‹è¯•åœºæ™¯
```http
### å¹´æŸ¥è¯¢æµ‹è¯•
POST http://localhost:8080/energy/realtime/getLoadTimeSeriesData
{
    "moduleIds": ["yj0001_1202", "yj0001_1203"],
    "timeGranularity": "year",
    "queryDate": "2025-01-01",
    "startTime": "2025-01-01 00:00:00",
    "endTime": "2025-12-31 23:59:59"
}
```

## ğŸ“ˆ é¢„æœŸç»“æœæ ¼å¼

### å¹´æŸ¥è¯¢å“åº”ç¤ºä¾‹
```json
{
    "success": true,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "result": {
        "powerChartData": {
            "title": "æœ‰åŠŸåŠŸç‡",
            "timeLabels": ["2025-01", "2025-02", ..., "2025-12"],
            "series": [
                {
                    "moduleId": "yj0001_1202",
                    "moduleName": "1å·é…ç”µæŸœ",
                    "unit": "kW",
                    "data": [85.5, 92.3, 78.9, ...]
                }
            ]
        },
        "loadRateChartData": {
            "title": "è´Ÿè·ç‡",
            "timeLabels": ["2025-01", "2025-02", ..., "2025-12"],
            "series": [
                {
                    "moduleId": "yj0001_1202",
                    "moduleName": "1å·é…ç”µæŸœ",
                    "unit": "%",
                    "data": [85.5, 92.3, 78.9, ...]
                }
            ]
        },
        "summary": {
            "totalDataPoints": 24,
            "granularity": "æ¯æœˆ",
            "moduleCount": 2,
            "dataType": "è´Ÿè·ç›‘æ§æ•°æ®"
        }
    }
}
```

## âœ… åŠŸèƒ½éªŒè¯æ¸…å•

### ç¼–è¯‘éªŒè¯
- [x] Javaä»£ç ç¼–è¯‘æ— é”™è¯¯
- [x] æ‰€æœ‰ä¾èµ–é¡¹æ­£ç¡®å¯¼å…¥
- [x] æ–¹æ³•ç­¾ååŒ¹é…æ¥å£å®šä¹‰
- [x] æ•°æ®ç±»å‹è½¬æ¢æ­£ç¡®

### åŠŸèƒ½éªŒè¯
- [x] å¹´æŸ¥è¯¢è·¨æœˆæ•°æ®åº“è®¿é—®
- [x] æ—¶é—´èŒƒå›´è‡ªåŠ¨è®¡ç®—
- [x] è´Ÿè·ç‡è®¡ç®—é€»è¾‘
- [x] æ—¶åŒºè½¬æ¢å¤„ç†
- [x] å›¾è¡¨æ•°æ®æ ¼å¼åŒ–
- [x] è¡¨æ ¼æ•°æ®ç”Ÿæˆ

### æ¥å£éªŒè¯
- [x] APIè·¯å¾„æ˜ å°„æ­£ç¡®
- [x] è¯·æ±‚å‚æ•°éªŒè¯
- [x] å“åº”æ ¼å¼æ ‡å‡†åŒ–
- [x] å¼‚å¸¸å¤„ç†å®Œå–„

## ğŸš€ éƒ¨ç½²å’Œä½¿ç”¨

### å¯åŠ¨æ­¥éª¤
1. ç¡®ä¿InfluxDBæœåŠ¡è¿è¡Œ
2. ç¡®ä¿MySQLæ•°æ®åº“è¿æ¥æ­£å¸¸
3. å¯åŠ¨Spring Bootåº”ç”¨
4. ä½¿ç”¨æµ‹è¯•æ–‡ä»¶éªŒè¯åŠŸèƒ½

### ä½¿ç”¨è¯´æ˜
1. **å‰ç«¯è°ƒç”¨**: ä½¿ç”¨æ ‡å‡†çš„POSTè¯·æ±‚è°ƒç”¨è´Ÿè·ç›‘æ§æ¥å£
2. **å‚æ•°è®¾ç½®**: è®¾ç½®timeGranularityä¸º"year"å¯ç”¨å¹´æŸ¥è¯¢
3. **æ•°æ®è§£æ**: è§£æè¿”å›çš„å›¾è¡¨æ•°æ®å’Œè¡¨æ ¼æ•°æ®
4. **é”™è¯¯å¤„ç†**: å¤„ç†å¯èƒ½çš„æ•°æ®åº“è¿æ¥æˆ–æŸ¥è¯¢å¼‚å¸¸

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡å®ç°æˆåŠŸå®Œæˆäº†è´Ÿè·ç›‘æ§å¹´æŸ¥è¯¢åŠŸèƒ½çš„æ‰€æœ‰è¦æ±‚ï¼š

### ä¸»è¦æˆå°±
1. **å®Œæ•´å®ç°**: æ”¯æŒæ—¥/æœˆ/å¹´ä¸‰ç§æ—¶é—´ç²’åº¦æŸ¥è¯¢
2. **è·¨æœˆæŸ¥è¯¢**: å¹´æŸ¥è¯¢è‡ªåŠ¨è·¨12ä¸ªæœˆä»½æ•°æ®åº“
3. **æ•°æ®å®Œæ•´**: åˆå¹¶æ‰€æœ‰ç›¸å…³æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœ
4. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©æœ€ä¼˜ç­–ç•¥
5. **å…¼å®¹æ€§å¥½**: ä¿æŒåŸæœ‰æ¥å£ä¸å˜ï¼Œæ–°å¢åŠŸèƒ½é€æ˜
6. **ä»£ç è´¨é‡**: ä¿®å¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯ï¼Œä»£ç ç»“æ„æ¸…æ™°

### æŠ€æœ¯ç‰¹ç‚¹
- **æ™ºèƒ½æŸ¥è¯¢**: è‡ªåŠ¨é€‰æ‹©å•æœˆæˆ–è·¨æœˆæŸ¥è¯¢ç­–ç•¥
- **æ•°æ®å®‰å…¨**: å®Œå–„çš„å‚æ•°éªŒè¯å’Œå¼‚å¸¸å¤„ç†
- **æ—¶åŒºå¤„ç†**: è‡ªåŠ¨UTCä¸åŒ—äº¬æ—¶é—´è½¬æ¢
- **è´Ÿè·è®¡ç®—**: è‡ªåŠ¨è®¡ç®—è´Ÿè·ç‡ï¼ˆåŠŸç‡/é¢å®šåŠŸç‡Ã—100%ï¼‰
- **å›¾è¡¨å‹å¥½**: ç”Ÿæˆå‰ç«¯å›¾è¡¨æ‰€éœ€çš„æ ‡å‡†æ ¼å¼æ•°æ®

ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨å¹´æŸ¥è¯¢åŠŸèƒ½æ¥åˆ†æè®¾å¤‡å…¨å¹´çš„è´Ÿè·å˜åŒ–è¶‹åŠ¿ï¼Œæ¯æœˆä¸€ä¸ªæ•°æ®ç‚¹ï¼Œä¾¿äºè¯†åˆ«å­£èŠ‚æ€§è´Ÿè·æ¨¡å¼å’Œé•¿æœŸè¶‹åŠ¿å˜åŒ–ã€‚