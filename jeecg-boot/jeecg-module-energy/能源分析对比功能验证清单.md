# 能源分析对比功能验证清单

## ✅ 编译状态检查

### 已验证无编译错误的文件：
- ✅ `EnergyAnalysisController.java` - 控制器
- ✅ `EnergyAnalysisServiceImpl.java` - 服务实现类
- ✅ `IEnergyAnalysisService.java` - 服务接口
- ✅ `TbModuleMapper.java` - Mapper接口
- ✅ `ModuleVO.java` - 仪表信息VO
- ✅ `CompareDataRequest.java` - 查询请求VO
- ✅ `CompareDataVO.java` - 响应数据VO
- ✅ `EnergyTypeVO.java` - 能源类型VO

### 已创建的XML配置：
- ✅ `TbModuleMapper.xml` - 扩展了SQL查询

## 🚀 功能验证步骤

### 1. 启动应用
```bash
cd jeecg-boot
mvn spring-boot:run
```

### 2. 健康检查
```bash
curl http://localhost:8080/jeecg-boot/energy/analysis/health
```

**预期响应**：
```json
{
  "success": true,
  "message": "操作成功",
  "code": 200,
  "result": "能源分析服务运行正常"
}
```

### 3. 获取能源类型配置
```bash
curl http://localhost:8080/jeecg-boot/energy/analysis/getEnergyTypes
```

**预期响应**：
```json
{
  "success": true,
  "code": 200,
  "result": [
    {
      "energyType": 1,
      "energyTypeName": "电",
      "unit": "kWh",
      "icon": "electric"
    },
    {
      "energyType": 2,
      "energyTypeName": "水",
      "unit": "m³",
      "icon": "water"
    },
    {
      "energyType": 3,
      "energyTypeName": "气",
      "unit": "m³",
      "icon": "gas"
    }
  ]
}
```

### 4. 获取注塑部门仪表列表
```bash
curl "http://localhost:8080/jeecg-boot/energy/analysis/getModulesByDimension?orgCode=A02A02A01&energyType=1"
```

**预期响应**：
```json
{
  "success": true,
  "code": 200,
  "result": [
    {
      "moduleId": "yj0001_1202",
      "moduleName": "1号注塑机",
      "energyType": 1,
      "energyTypeName": "电",
      "unit": "kWh",
      "dimensionName": "注塑部门",
      "dimensionId": "1881235917079482369",
      "gatewayCode": "yj0001_1",
      "meterId": "202",
      "ratedPower": 1000.00
    },
    {
      "moduleId": "yj0001_12",
      "moduleName": "2号注塑机",
      "energyType": 1,
      "energyTypeName": "电",
      "unit": "kWh",
      "dimensionName": "注塑部门",
      "dimensionId": "1940618841356288002",
      "gatewayCode": "yj0001_1",
      "meterId": "2",
      "ratedPower": 1000.00
    }
  ]
}
```

### 5. 查询1号注塑机日对比数据
```bash
curl -X POST "http://localhost:8080/jeecg-boot/energy/analysis/getCompareData" \
     -H "Content-Type: application/json" \
     -d '{
       "moduleId": "yj0001_1202",
       "timeType": "day",
       "startTime": "2025-07-26",
       "endTime": "2025-08-02",
       "compareType": "compare"
     }'
```

**预期响应结构**：
```json
{
  "success": true,
  "code": 200,
  "result": {
    "summary": {
      "totalConsumption": 296.37,
      "previousConsumption": 201.74,
      "growthRate": 31.93,
      "unit": "kWh"
    },
    "chartData": {
      "categories": ["07-26", "07-27", "07-28", "07-29", "07-30", "07-31", "08-01", "08-02"],
      "series": [
        {
          "name": "本期用电量",
          "data": [289, 283, 299, 250, 240, 180, 190, 200],
          "unit": "kWh"
        },
        {
          "name": "对比用电量",
          "data": [250, 260, 283, 220, 200, 150, 170, 180],
          "unit": "kWh"
        }
      ]
    },
    "tableData": [
      {
        "date": "07-26",
        "currentConsumption": 289,
        "previousConsumption": 250,
        "difference": 39,
        "growthRate": 15.6
      }
    ],
    "moduleInfo": {
      "moduleId": "yj0001_1202",
      "moduleName": "1号注塑机",
      "energyType": 1,
      "unit": "kWh",
      "dimensionName": "注塑部门"
    }
  }
}
```

## 🔍 数据库验证

### 1. 检查仪表数据
```sql
-- 查看仪表基础信息
SELECT module_id, module_name, energy_type, sys_org_code 
FROM tb_module 
WHERE isaction = 'Y' 
LIMIT 5;
```

### 2. 检查维度数据
```sql
-- 查看维度信息
SELECT id, depart_name, org_code, parent_id 
FROM sys_depart 
WHERE org_code IN ('A02A02A01', 'A02A02A04', 'A02A02A05');
```

### 3. 检查统计数据
```sql
-- 查看日统计数据
SELECT module_id, dt, energy_count 
FROM tb_ep_equ_energy_daycount 
WHERE module_id = 'yj0001_1202' 
ORDER BY dt DESC 
LIMIT 5;
```

## 🧪 错误处理验证

### 1. 参数缺失测试
```bash
curl -X POST "http://localhost:8080/jeecg-boot/energy/analysis/getCompareData" \
     -H "Content-Type: application/json" \
     -d '{
       "moduleId": "",
       "timeType": "day"
     }'
```

**预期响应**：
```json
{
  "success": false,
  "code": 500,
  "message": "仪表ID不能为空"
}
```

### 2. 错误时间类型测试
```bash
curl -X POST "http://localhost:8080/jeecg-boot/energy/analysis/getCompareData" \
     -H "Content-Type: application/json" \
     -d '{
       "moduleId": "yj0001_1202",
       "timeType": "invalid",
       "startTime": "2025-07-26",
       "endTime": "2025-08-02"
     }'
```

**预期响应**：
```json
{
  "success": false,
  "code": 500,
  "message": "时间类型只支持：day、month、year"
}
```

### 3. 维度编码缺失测试
```bash
curl "http://localhost:8080/jeecg-boot/energy/analysis/getModulesByDimension?orgCode="
```

**预期响应**：
```json
{
  "success": false,
  "code": 500,
  "message": "维度编码不能为空"
}
```

## 📊 Swagger文档验证

### 访问Swagger文档
```
http://localhost:8080/jeecg-boot/doc.html
```

### 验证项目：
- [ ] 能源分析对比模块是否出现在文档中
- [ ] 所有接口是否正确显示
- [ ] 参数说明是否完整
- [ ] 响应示例是否正确

## 🎯 功能完整性检查

### 核心功能：
- [ ] ✅ 根据维度获取仪表列表
- [ ] ✅ 支持子维度递归查询
- [ ] ✅ 支持能源类型筛选
- [ ] ✅ 日对比数据查询
- [ ] ✅ 月对比数据查询
- [ ] ✅ 年对比数据查询
- [ ] ✅ 同比增长率计算
- [ ] ✅ 能源类型配置查询

### 数据结构：
- [ ] ✅ 汇总数据（总消耗、增长率等）
- [ ] ✅ 图表数据（时间轴、系列数据）
- [ ] ✅ 表格数据（详细对比）
- [ ] ✅ 仪表信息（基本信息）

### 异常处理：
- [ ] ✅ 参数验证
- [ ] ✅ 数据为空处理
- [ ] ✅ 错误响应格式
- [ ] ✅ 日志记录

## 📝 验证结果记录

### 测试时间：_____________

### 测试结果：
- [ ] 所有接口正常响应
- [ ] 数据格式正确
- [ ] 错误处理正常
- [ ] Swagger文档完整
- [ ] 数据库查询正常

### 发现的问题：
1. ________________________________
2. ________________________________
3. ________________________________

### 需要修复的项目：
1. ________________________________
2. ________________________________
3. ________________________________

## 🎉 验证完成标志

当以下所有项目都通过时，说明能源分析对比功能实现成功：

- [ ] ✅ 编译无错误
- [ ] ✅ 启动无异常
- [ ] ✅ 健康检查通过
- [ ] ✅ 能源类型配置正确返回
- [ ] ✅ 仪表列表查询正常
- [ ] ✅ 对比数据查询正常
- [ ] ✅ 错误处理正确
- [ ] ✅ Swagger文档完整
- [ ] ✅ 数据库查询正常

**恭喜！能源分析对比功能实现完成！** 🎉
