# Real_Data_Monitor_FH 页面改造说明

## 改造内容

根据接口文档 `Real_Data_Monitor_FH.md`，将页面从静态数据改为调用 API 获取动态数据。

### 主要修改

1. **新增 API 文件** (`api.ts`)
   - 添加了 4 个主要接口：
     - `getModulesByDimension`: 根据维度获取仪表列表
     - `getParameterConfig`: 获取参数配置
     - `getTimeSeriesData`: 查询时序数据（核心接口）
     - `getCurrentStatus`: 获取实时状态
   - 定义了完整的 TypeScript 类型

2. **页面功能增强**
   - 添加参数选择器，支持多参数查询
   - 根据维度动态加载仪表列表
   - 根据能源类型动态加载参数配置
   - 支持日/月/年不同时间粒度查询
   - 自动查询功能（选择仪表和参数后自动查询）

3. **数据处理优化**
   - 使用新的 API 接口获取时序数据
   - 动态更新有功功率和负荷率图表
   - 自动计算统计数据表格
   - 支持多仪表、多参数数据展示

### 核心功能流程

1. **页面初始化**
   - 加载维度字典数据
   - 加载默认参数配置（电力类型）
   - 设置默认日期为今天

2. **维度选择**
   - 切换维度标签页时，加载对应能源类型的参数配置
   - 清空仪表选择，等待用户重新选择设备

3. **设备选择**
   - 左侧树选择设备后，调用 `getModulesByDimension` 获取仪表列表
   - 默认选择所有仪表

4. **数据查询**
   - 选择仪表和参数后，调用 `getTimeSeriesData` 获取时序数据
   - 根据时间粒度（日/月/年）查询不同间隔的数据
   - 自动更新图表和统计表格

### 接口对应关系

| 功能 | 原接口 | 新接口 | 说明 |
|------|--------|--------|------|
| 获取仪表列表 | `getModulesByOrgCode` | `getModulesByDimension` | 根据维度编码获取仪表 |
| 查询时序数据 | `getRealTimeMonitorData` | `getTimeSeriesData` | 支持多时间粒度查询 |
| 参数配置 | 无 | `getParameterConfig` | 新增参数配置功能 |
| 实时状态 | 无 | `getCurrentStatus` | 新增实时状态功能 |

### 图表数据处理

- **有功功率图表**: 筛选包含"有功"或"功率"的参数数据
- **负荷率图表**: 筛选包含"负荷"或"率"的参数数据
- **统计表格**: 自动计算最大值、最小值、平均值及对应的负荷率

### 时间粒度支持

- **日查询**: 24小时数据，每小时一个数据点
- **月查询**: 整月数据，每天一个数据点  
- **年查询**: 整年数据，每月一个数据点

### 注意事项

1. 左侧维度树功能保持不变，继续使用原有的 `MultiSelectDimensionTree` 组件
2. 图表组件 `LineChart` 保持兼容，支持新的数据格式
3. 添加了加载状态和错误处理
4. 支持自动查询功能，提升用户体验

### 测试建议

1. 测试不同维度的切换
2. 测试仪表选择和参数选择
3. 测试不同时间粒度的查询
4. 测试图表数据更新
5. 测试错误处理和加载状态
