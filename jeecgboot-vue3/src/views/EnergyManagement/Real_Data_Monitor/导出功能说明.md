# 实时数据监控 - Excel导出功能说明

## 功能概述

实时数据监控模块现已支持将查询到的数据导出为Excel文件，方便用户进行数据分析和报表制作。

## 使用方法

### 1. 基本操作步骤

1. **选择维度和仪表**
   - 在左侧维度树中选择要查询的部门/区域
   - 在仪表选择下拉框中选择一个或多个仪表

2. **选择参数**
   - 在参数选择下拉框中选择要导出的参数（如：A相电流、A相电压、总有功功率等）
   - 支持多选，可以同时导出多个参数的数据

3. **设置时间范围**
   - 选择开始时间和结束时间
   - 选择查询间隔（15分钟、30分钟、1小时、2小时）

4. **执行导出**
   - 点击图表区域右上角的"导出数据"按钮
   - 系统会自动下载Excel文件到本地

### 2. 导出按钮位置

- **统一显示模式**：在图表标题栏右侧
- **分开显示模式**：在每个图表的标题栏右侧

### 3. 导出文件格式

#### 文件命名规则
```
实时数据导出_YYYYMMDD_HHmmss.xlsx
例如：实时数据导出_20250723_143025.xlsx
```

#### Excel表格结构
- **第一行**：标题行，包含时间列和各仪表参数列
- **数据行**：按时间顺序排列，每行对应一个时间点的所有参数值

#### 列名格式
```
{仪表名称}/{参数名称}({单位})
例如：中电电气1号变压器/A相电流(A)
```

## 技术实现

### 1. API接口
- **接口地址**：`/energy/monitor/exportRealTimeData`
- **请求方式**：POST
- **响应类型**：Excel文件流

### 2. 请求参数
```json
{
  "moduleIds": ["yj0001_1202", "yj0001_12"],
  "parameters": [1, 4, 7],
  "startTime": "2025-07-23 00:00:00",
  "endTime": "2025-07-23 15:55:00",
  "interval": 1,
  "displayMode": 1,
  "fileName": "实时数据导出_20250723_143025"
}
```

### 3. 前端实现特点
- **参数验证**：导出前验证仪表、参数、时间范围是否完整
- **加载状态**：导出过程中显示加载动画，防止重复点击
- **错误处理**：提供详细的错误提示信息
- **自动下载**：使用Blob API实现文件自动下载

## 注意事项

### 1. 使用限制
- 必须先选择仪表和参数才能导出
- 必须设置有效的时间范围
- 导出的数据量受时间范围和查询间隔影响

### 2. 性能考虑
- 大时间范围的数据导出可能需要较长时间
- 建议合理设置时间范围，避免一次性导出过多数据
- 导出过程中请耐心等待，不要重复点击

### 3. 数据格式
- 时间格式：`yyyy-MM-dd HH:mm`
- 数值格式：保留2位小数
- 空值显示："-"

## 故障排除

### 1. 常见问题

**问题**：点击导出按钮没有反应
**解决**：检查是否已选择仪表、参数和时间范围

**问题**：导出失败提示网络错误
**解决**：检查网络连接和后端服务状态

**问题**：导出的Excel文件打不开
**解决**：确认浏览器支持文件下载，检查下载文件是否完整

### 2. 错误信息说明
- `请选择至少一个仪表`：需要在仪表下拉框中选择仪表
- `请选择至少一个参数`：需要在参数下拉框中选择参数
- `请选择时间范围`：需要设置开始和结束时间
- `导出接口不存在`：后端服务问题，联系管理员
- `服务器内部错误`：后端处理异常，联系管理员

## 更新日志

### v1.0.0 (2025-07-23)
- ✅ 实现基本的Excel导出功能
- ✅ 支持统一显示和分开显示两种模式
- ✅ 添加参数验证和错误处理
- ✅ 实现自动文件下载
- ✅ 添加导出状态提示
