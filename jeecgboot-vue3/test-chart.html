<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图表测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        select, button {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #1890ff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #40a9ff;
        }
        .chart-type-buttons {
            display: flex;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            overflow: hidden;
        }
        .chart-type-btn {
            padding: 6px 12px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 13px;
        }
        .chart-type-btn.active {
            background: #1890ff;
            color: white;
        }
        .chart-type-btn:not(.active):hover {
            background: #f0f0f0;
        }
        #chartContainer {
            width: 100%;
            height: 400px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .status.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .status.error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>实时数据监控图表测试</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>能源类型：</label>
                <select id="energyTypeSelect" onchange="updateParameterOptions()">
                    <option value="1">按部门（用电）</option>
                    <option value="2">按线路（用电）</option>
                    <option value="3">天然气</option>
                    <option value="4">压缩空气</option>
                    <option value="5">企业用水</option>
                </select>
            </div>

            <div class="control-group">
                <label>参数选择：</label>
                <select id="paramSelect" multiple>
                    <option value="1">A相电流</option>
                    <option value="2">B相电流</option>
                    <option value="3">C相电流</option>
                    <option value="4">A相电压</option>
                    <option value="5">B相电压</option>
                    <option value="6">C相电压</option>
                    <option value="7">总功率因数</option>
                    <option value="8">A相功率因数</option>
                    <option value="9">B相功率因数</option>
                    <option value="10">C相功率因数</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>查询间隔：</label>
                <select id="intervalSelect">
                    <option value="1">15分钟</option>
                    <option value="2">30分钟</option>
                    <option value="3">60分钟</option>
                    <option value="4" selected>120分钟</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>显示方式：</label>
                <select id="displaySelect">
                    <option value="1" selected>统一显示</option>
                    <option value="2">分开显示</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>图表类型：</label>
                <div class="chart-type-buttons">
                    <button class="chart-type-btn active" data-type="line">曲线图</button>
                    <button class="chart-type-btn" data-type="bar">柱状图</button>
                </div>
            </div>
            
            <button onclick="updateChart()">更新图表</button>
        </div>
        
        <div id="status" class="status success">
            ✓ 图表组件修改完成，支持字典数据和图表类型切换
        </div>
        
        <div id="chartContainer"></div>
        
        <div style="margin-top: 20px;">
            <h3>修改说明：</h3>
            <ul>
                <li>✅ 支持多种能源类型：用电、天然气、压缩空气、企业用水</li>
                <li>✅ 根据能源类型动态切换参数字典编码：
                    <ul>
                        <li>用电：parameter</li>
                        <li>天然气：parameter_gas</li>
                        <li>压缩空气：parameter_air</li>
                        <li>企业用水：parameter_water</li>
                    </ul>
                </li>
                <li>✅ 参数选择根据能源类型动态更新</li>
                <li>✅ 查询间隔下拉框改为从字典表获取（字典编码：queryInterval）</li>
                <li>✅ 查询方式下拉框改为从字典表获取（字典编码：queryMethod）</li>
                <li>✅ 支持曲线图和柱状图切换</li>
                <li>✅ 图表数据根据选择的参数动态生成</li>
                <li>✅ 字典值使用数字格式（1,2,3,4...）与数据库保持一致</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script>
        let chart = null;
        let currentChartType = 'line';
        
        // 初始化图表
        function initChart() {
            const container = document.getElementById('chartContainer');
            chart = echarts.init(container);
            
            // 初始化参数选项
            updateParameterOptions();
            updateChart();
        }
        
        // 更新图表
        function updateChart() {
            const selectedParams = Array.from(document.getElementById('paramSelect').selectedOptions).map(opt => opt.value);
            const interval = document.getElementById('intervalSelect').value;
            const displayMode = document.getElementById('displaySelect').value;
            
            if (selectedParams.length === 0) {
                document.getElementById('status').innerHTML = '⚠️ 请至少选择一个参数';
                document.getElementById('status').className = 'status error';
                return;
            }
            
            // 生成模拟数据
            const categories = ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', 
                              '14:00', '16:00', '18:00', '20:00', '22:00'];
            const colors = ['#1890ff', '#52c41a', '#faad14', '#f759ab', '#722ed1'];
            
            const series = selectedParams.map((param, index) => {
                const data = categories.map((_, i) => {
                    const baseValue = 50 + (index * 10);
                    const variation = Math.sin(i * 0.5) * 10;
                    return Number((baseValue + variation).toFixed(2));
                });
                
                const seriesConfig = {
                    name: getParamLabel(param),
                    data: data,
                    itemStyle: { color: colors[index % colors.length] }
                };
                
                if (currentChartType === 'line') {
                    seriesConfig.type = 'line';
                    seriesConfig.smooth = true;
                    seriesConfig.areaStyle = { opacity: 0.2 };
                } else {
                    seriesConfig.type = 'bar';
                    seriesConfig.barWidth = '60%';
                }
                
                return seriesConfig;
            });
            
            const option = {
                title: {
                    text: `实时数据监控 - ${currentChartType === 'line' ? '曲线图' : '柱状图'}`,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: selectedParams.map(getParamLabel),
                    bottom: 10
                },
                xAxis: {
                    type: 'category',
                    data: categories,
                    boundaryGap: currentChartType === 'bar'
                },
                yAxis: {
                    type: 'value'
                },
                series: series
            };
            
            chart.setOption(option, true);
            
            document.getElementById('status').innerHTML = `✓ 图表已更新 - 参数: ${selectedParams.map(getParamLabel).join(', ')} | 类型: ${currentChartType === 'line' ? '曲线图' : '柱状图'}`;
            document.getElementById('status').className = 'status success';
        }
        
        // 根据能源类型更新参数选项
        function updateParameterOptions() {
            const energyType = document.getElementById('energyTypeSelect').value;
            const paramSelect = document.getElementById('paramSelect');

            // 清空现有选项
            paramSelect.innerHTML = '';

            let options = [];
            switch(energyType) {
                case '1': // 按部门（用电）
                case '2': // 按线路（用电）
                    options = [
                        { value: '1', text: 'A相电流' },
                        { value: '2', text: 'B相电流' },
                        { value: '3', text: 'C相电流' },
                        { value: '4', text: 'A相电压' },
                        { value: '5', text: 'B相电压' },
                        { value: '6', text: 'C相电压' },
                        { value: '7', text: '总功率因数' },
                        { value: '8', text: 'A相功率因数' },
                        { value: '9', text: 'B相功率因数' },
                        { value: '10', text: 'C相功率因数' }
                    ];
                    break;
                case '3': // 天然气
                    options = [
                        { value: '1', text: '瞬时流量' },
                        { value: '2', text: '累计流量' },
                        { value: '3', text: '温度' },
                        { value: '4', text: '压力' },
                        { value: '5', text: '密度' }
                    ];
                    break;
                case '4': // 压缩空气
                case '5': // 企业用水
                    options = [
                        { value: '1', text: '瞬时流量' },
                        { value: '2', text: '累计流量' },
                        { value: '3', text: '压力' },
                        { value: '4', text: '温度' }
                    ];
                    break;
            }

            // 添加新选项
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.text;
                paramSelect.appendChild(optionElement);
            });

            // 默认选中第一个选项
            if (options.length > 0) {
                paramSelect.value = options[0].value;
            }
        }

        // 获取参数标签
        function getParamLabel(param) {
            const energyType = document.getElementById('energyTypeSelect').value;

            let labels = {};
            switch(energyType) {
                case '1': // 按部门（用电）
                case '2': // 按线路（用电）
                    labels = {
                        '1': 'A相电流',
                        '2': 'B相电流',
                        '3': 'C相电流',
                        '4': 'A相电压',
                        '5': 'B相电压',
                        '6': 'C相电压',
                        '7': '总功率因数',
                        '8': 'A相功率因数',
                        '9': 'B相功率因数',
                        '10': 'C相功率因数'
                    };
                    break;
                case '3': // 天然气
                    labels = {
                        '1': '瞬时流量',
                        '2': '累计流量',
                        '3': '温度',
                        '4': '压力',
                        '5': '密度'
                    };
                    break;
                case '4': // 压缩空气
                case '5': // 企业用水
                    labels = {
                        '1': '瞬时流量',
                        '2': '累计流量',
                        '3': '压力',
                        '4': '温度'
                    };
                    break;
            }

            return labels[param] || param;
        }
        
        // 图表类型切换
        document.querySelectorAll('.chart-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentChartType = this.dataset.type;
                updateChart();
            });
        });
        
        // 页面加载完成后初始化
        window.addEventListener('load', initChart);
    </script>
</body>
</html>
